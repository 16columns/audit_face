 <script type="text/javascript" src="//www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1', {packages: ['corechart']});
    </script>

<div class="container">
  
    <div class="row-fluid">
       
       
        <div class="col-lg-2 col-lg-offset-1">
           <small>
           <div class="panel panel-default">
         <div class="panel-heading">
           <strong> My Audits </strong>
         </div>
          <div class="panel-body">
           <span class="col-lg-offset-4">
                  <%= current_user.audits.count %>
            </span>
          </div>
        </div>
             </small>
      </div>
      
      <div class="col-lg-2">
           <small>
           <div class="panel panel-default">
         <div class="panel-heading">
           <strong>My Findings</strong>
         </div>
          <div class="panel-body">
           <span class="col-lg-offset-4">
           
             <%= @finding_count %>
            </span>
          </div>
        </div>
             </small>
      </div>
          
       
      
      <div class="col-lg-3">
           <small>
           <div class="panel panel-default">
         <div class="panel-heading">
         Open Audits (30 days +)
         </div>
          <div class="panel-body">
           <span class="col-lg-offset-6">
           <a href class="btn-link" data-toggle="modal" data-target="#openaudits">
           <%= @open_audits_count %></a>
            </span>
          </div>
        </div>
             </small>
      </div>
      
       <div class="col-lg-3">
           <small>
           <div class="panel panel-default">
         <div class="panel-heading">
         Upcoming Audits
         </div>
          <div class="panel-body">
           <span class="col-lg-offset-6">
           <a href class="btn-link" data-toggle="modal" data-target="#upcomingaudits">
           <%= @upcoming_audits.count %></a>
            </span>
          </div>
        </div>
             </small>
      </div>
      
  </div>
</div>
  <div class="page-header"></div>
<div class="container">
  <div class="row-fluid">
    <div class="col-lg-12 col-md-12">
     <div id="visualization" style="width: 1000px; height: 300px;"></div> 
    </div>
  
  </div>
  </div>
  <div class="page-header"></div>
  <div class="container">
  <div class="row-fluid">
    <div class="col-lg-5 col-md-5">
     <div id="pie-visualization" style="width: 500px; height: 300px;"></div> 
    </div>
    
  </div>
</div>                                                                           
     
<div class="modal fade" id="openaudits" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Open Audits (Greater than 30 days)</h4>
      </div>
      <div class="modal-body">
        <table class="table table-hover table-responsive">
        <thead>
		
            <tr style="background:#ecf0f1">
		    <th> Audit ID</th>
		    <th>Department name</th>
            <th>Created Date</th>
            <th>Auditor</th>
            <th>Ageing</th>
 	        </tr>
        </thead>
        
        <tbody>
        <% @open_audits.each do |audit| %>
        <tr>
          <td><%= audit.id %> </td>
          <td><%= audit.department_name %></td>
          <td><%= audit.created_at.strftime("%d-%m-%y") %></td>
          <td><%= audit.auditor_name %></td>
          <td><%= (Time.now.to_date - finding.created_at.to_date).to_i %></td>
        </tr>
        <%end%>
	    
        </tbody>
      </table>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="modal fade" id="upcomingaudits" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Upcoming audits</h4>
      </div>
      <div class="modal-body">
        <table class="table table-hover table-responsive">
        <thead>
		
            <tr style="background:#ecf0f1">
		    <th> Audit ID</th>
		    <th>Department name</th>
            <th>Created Date</th>
            <th>Auditor</th>
            <th>Begins on</th>
 	        </tr>
        </thead>
        
        <tbody>
        <% @upcoming_audits.each do |audit| %>
          <tr>
          <td><%= audit.id %> </td>
          <td><%= audit.department_name %></td>
          <td><%= audit.created_at.strftime("%d-%m-%y") %></td>
          <td><%= audit.auditor_name %></td>
          <td><%= audit.start_date.strftime("%d-%m-%y") %></td>
          </tr>
        <%end%>
	    
        </tbody>
      </table>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
       
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



<script type="text/javascript">
      function drawVisualization() {
        // Create and populate the data table.
        //   alert("<%= current_user.audits %>")
        var dataTable = new google.visualization.DataTable();
         var newData = [['Year', 'Sales', 'Expenses' , 'Other'],
            ['2004',  1000,      400     ,  232   ],
            ['2005',  1170,      460    ,  421   ],
            ['2006',  660,       1120    ,  4324  ],
            ['2007',  1030,      540     ,  4234  ],
            ['2008',  1530,      50     ,    234  ]];
        
          // determine the number of rows and columns.
          var numRows = newData.length;
          var numCols = newData[0].length;
        
          // in this case the first column is of type 'string'.
          dataTable.addColumn('string', newData[0][0]);
        
          // all other columns are of type 'number'.
          for (var i = 1; i < numCols; i++)
            dataTable.addColumn('number', newData[0][i]);           
        
          // now add the rows.
          for (var i = 1; i < numRows; i++) 
            dataTable.addRow(newData[i]);
         
        
        
        var data = google.visualization.arrayToDataTable([
          ['month', 'open', 'in progress', 'closed'],   
          ['Jan',  4,   2,       1],
          ['Feb',  3,  13,      3],
          ['Mar',  9,   12,      6],
          ['Apr',  7,   8,       1],
          ['May',  7,   8,       1],
          ['Jun',  7,   8,       1],
          ['Jul',  7,   8,       1],
          ['Aug',  7,   8,       1],
          ['Sep',  7,   8,       1],
          ['Oct',  7,   8,       1],
          ['Nov',  7,   8,       1],
          ['Dec',  7,   8,       1]
        ]);
      
        // Create and draw the visualization.
        new google.visualization.ColumnChart(document.getElementById('visualization')).
            draw(dataTable,
                 {title:"Monthly Audit Status",
                  width:1000, height:300,
                  
                  hAxis: {title: "Month"}}
            );
      }
      

      function drawPieVisualization() {
        var data = google.visualization.arrayToDataTable([
          ['Findings', 'Months'],
          ['CAPA Pending',     6],
          ['CAPA Submitted',      5],
          ['Closed',  4],
        ]);

        var options = {
          title: 'Overall finding status'
        };

        var chart = new google.visualization.PieChart(document.getElementById('pie-visualization'));
        chart.draw(data, options);
      }

  
  
      google.setOnLoadCallback(drawVisualization);
      google.setOnLoadCallback(drawPieVisualization);
    </script>
